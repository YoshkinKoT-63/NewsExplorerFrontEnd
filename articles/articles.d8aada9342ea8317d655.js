!function(t){var e={};function r(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(o,s,function(e){return t[e]}.bind(null,s));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=11)}([function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));class o{constructor(){}_setHandlers(t){t.forEach(t=>{this._addHandler(...t)})}_addHandler(t,e,r){t.addEventListener(e,r)}_removeHandler(t,e,r){t.removeEventListener(e,r)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return s})),r.d(e,"d",(function(){return n})),r.d(e,"c",(function(){return i}));const o=document.querySelector(".header__container"),s=document.querySelector("#nav-authorized-template"),n=document.querySelector("#nav-unauthorized-template"),i=document.querySelector("#saved-articles-template")},function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return n}));const o=document.querySelector("#card").content.querySelector(".card"),s=document.querySelector(".result__cards-container"),n=document.querySelector(".result__show-more")},function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"c",(function(){return s})),r.d(e,"b",(function(){return n}));const o={empty:"Это обязательное поле",wrongLength:"Должно быть от 2 до 30 символов",wrongUrl:"Здесь должна быть ссылка",wrongEmail:"Неправильный формат email",wrongPassword:"Должно быть не меньше 8 символов"},s={url:"https://api.newsxplorer.ru",headers:{"Content-Type":"application/json"}},n={key:"fba4e04be8764ddf9ace1cfaaa116caa",url:"https://nomoreparties.co/news",pageSize:"100"}},function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));class o{constructor(t){this._option=t}_getResponseData(t){return t.ok?t.json():Promise.reject("Ошибка: "+t.status)}signup(t,e,r){return fetch(this._option.url+"/signup",{redirect:"follow",credentials:"include",method:"POST",headers:this._option.headers,body:JSON.stringify({email:t,password:e,name:r})}).then(t=>this._getResponseData(t))}signin(t,e){return fetch(this._option.url+"/signin",{redirect:"follow",credentials:"include",method:"POST",headers:this._option.headers,body:JSON.stringify({email:t,password:e})}).then(t=>this._getResponseData(t))}getUserData(){return this._option.headers.Authorization="Bearer "+localStorage.getItem("jwt"),fetch(this._option.url+"/users/me",{redirect:"follow",credentials:"include",method:"GET",headers:this._option.headers}).then(t=>this._getResponseData(t))}saveArticle(t){return this._option.headers.Authorization="Bearer "+localStorage.getItem("jwt"),fetch(this._option.url+"/articles",{credentials:"include",method:"POST",headers:this._option.headers,body:JSON.stringify({keyword:t.keyword,title:t.title,text:t.text,date:t.date,source:t.source,link:t.link,image:t.image})}).then(t=>this._getResponseData(t))}deleteArticle(t){return this._option.headers.Authorization="Bearer "+localStorage.getItem("jwt"),fetch(`${this._option.url}/articles/${t.id}`,{credentials:"include",method:"DELETE",headers:this._option.headers,body:JSON.stringify({})}).then(t=>this._getResponseData(t))}getArticles(){return this._option.headers.Authorization="Bearer "+localStorage.getItem("jwt"),fetch(this._option.url+"/articles",{credentials:"include",method:"GET",headers:this._option.headers}).then(t=>this._getResponseData(t))}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var o=r(0);class s extends o.a{constructor(t,e,r,o,s){super(),this._container=t,this.authMenu=e,this.unAuthMenu=r,this.savedArticles=o,this.pageName=s,this.logo=t.querySelector(".header__logo")}render(){window.localStorage.getItem("jwt")?"main"===this.pageName?(this._template=this.authMenu.content.querySelector(".header__nav-container"),this._element=this._template.cloneNode(!0),this._buttonLogOut=this._element.querySelector(".header__logout"),this._buttonLogOut.textContent=window.localStorage.getItem("name"),this._addHandler(this._buttonLogOut,"click",()=>{try{window.localStorage.removeItem("jwt"),window.localStorage.removeItem("name"),location.reload()}catch(t){console.log(t)}}),this._container.appendChild(this._element)):(this._template=this.savedArticles.content.querySelector(".header__nav-container"),this._element=this._template.cloneNode(!0),this._buttonLogOut=this._element.querySelector(".header__logout"),this._buttonLogOut.textContent=window.localStorage.getItem("name"),this._addHandler(this._buttonLogOut,"click",()=>{try{window.localStorage.removeItem("jwt"),window.localStorage.removeItem("name"),location.reload()}catch(t){console.log(t)}}),this._container.appendChild(this._element)):(this._template=this.unAuthMenu.content.querySelector(".header__nav-container"),this._element=this._template.cloneNode(!0),this._container.appendChild(this._element)),this.header_nav=this._container.querySelector(".header__nav-links"),this.header_button=this._container.querySelector(".header__button"),this._addHandler(this.header_button,"click",()=>this.burgerShow())}burgerShow(){this.header_nav.classList.toggle("header__nav-links_is-opened"),this.logo.classList.toggle("header__logo_white"),this.header_button.classList.toggle("header__button_dark")}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var o=r(0);class s extends o.a{constructor(t,e,r){super(),this.cardList=t,this.showMoreButton=e,this.newCard=r,this.addCard=this.addCard.bind(this),this.cards=[],this.keyword="",this.renderResult=this.renderResult.bind(this),this.showMore=this.showMore.bind(this),this.toggleShowMoreButton=this.toggleShowMoreButton.bind(this)}addCard(t,e,r){this.cardList.appendChild(this.newCard.create(t,e,r))}setKeyword(t){this.keyword=t}clear(){this.cardList.innerHTML="",this.cards=[],this.keyword=""}toggleShowMoreButton(){this.counter===this.cards.length?this.showMoreButton.classList.add("result_hide"):this.showMoreButton.classList.remove("result_hide")}renderSaveCard(t){this.cards=t.articles,this.cards.forEach(t=>this.addCard(t,t.keyword,t._id)),this.number=this.cards.length}renderResult(t){for(this.cards=t.articles,this.number=this.cards.length<3?this.cards.length:3,this.counter=0;this.counter<this.number;this.counter++)this.addCard(this.cards[this.counter],this.keyword,0);this.toggleShowMoreButton()}showMore(){if(this.cards.length-this.counter<3){for(let t=this.counter;t<this.cards.length;t++)this.addCard(this.cards[t],this.keyword,0);this.counter=this.cards.length}else{this.counter+=3;for(let t=this.counter-3;t<this.counter;t++)this.addCard(this.cards[t],this.keyword,0)}}setEventListeners(){this._setHandlers([[this.showMoreButton,"click",this.showMore],[this.showMoreButton,"click",this.toggleShowMoreButton]])}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var o=t=>t.length<=30?t:t.substr(0,t.lastIndexOf(" ",30))+"...";var s=t=>{const e=new Date(t);return`${e.toLocaleDateString("ru-RU",{day:"numeric",month:"long"})}, ${e.getFullYear()}`};class n{constructor(t,e,r){this.card=t,this.mainApi=e,this.formatDate=s,this.cutText=o,this.saveCard=this.saveCard.bind(this),this.deleteCard=this.deleteCard.bind(this),this.pageName=r}saveCard(t){t.preventDefault();const e=t.target.parentNode;if(t.target.classList.contains("card__button_added")){const e=t.target.parentNode.id;this.mainApi.deleteArticle({id:e}).then(e=>{t.target.classList.toggle("card__button_add"),t.target.classList.toggle("card__button_added"),t.target.parentNode.removeAttribute("id")}).catch(t=>{console.log(t)})}else{const r=e.querySelector(".card__keyword").textContent,o=this.cutText(e.querySelector(".card__tittle").textContent),s=e.querySelector(".card__text").textContent,n=e.querySelector(".card__date").textContent,i=e.querySelector(".card__source").textContent,a=e.href,d=e.querySelector(".card__image").src;this.mainApi.saveArticle({keyword:r,title:o,text:s,date:n,source:i,link:a,image:d}).then(e=>{t.target.classList.toggle("card__button_add"),t.target.classList.toggle("card__button_added"),t.target.parentNode.id=e.data._id}).catch(t=>{console.log(t)})}}deleteCard(t){t.preventDefault();const e=t.target.parentNode.id;console.log({id:e}),this.mainApi.deleteArticle({id:e}).then(e=>{t.target.parentNode.remove()}).catch(t=>{console.log(t)})}create(t,e,r){return this._element=this.card.cloneNode(!0),null!==t.urlToImage&&(this._element.querySelector(".card__image").src=t.urlToImage),this.button=this._element.querySelector(".card__button"),window.localStorage.getItem("jwt")&&(this._element.querySelector(".card__keyword").classList.remove("card__keyword_hide"),this._element.querySelector(".card__keyword").textContent=e.toLowerCase(),this.button.classList.remove("card__button_unlogged"),this.button.disabled=!1,r&&(this._element.id=r),this.button.classList.contains("card__button_add")&&this.button.addEventListener("click",this.saveCard),this.button.classList.contains("card__button_delete")&&this.button.addEventListener("click",this.deleteCard)),this._element.querySelector(".card__date").textContent="main"===this.pageName?this.formatDate(t.publishedAt):t.publishedAt,this._element.querySelector(".card__tittle").textContent=t.title,this._element.querySelector(".card__text").textContent=t.description,this._element.querySelector(".card__source").textContent=t.source.name,this._element.href=t.url,this._element}}},,function(t,e,r){},,function(t,e,r){"use strict";r.r(e);r(9);var o=r(3),s=r(1),n=r(2);const i=document.querySelector(".report__container");var a=r(4),d=r(5),c=r(6),h=r(7);var l=t=>t?t[0].toUpperCase()+t.slice(1):t;var u=(t,e)=>{t.forEach(t=>{const{_id:r,date:o,image:s,keyword:n,link:i,source:a,title:d,text:c}=t;e.push({_id:r,description:c,source:{name:a},title:d,url:i,urlToImage:s,publishedAt:o,keyword:n})})};window.localStorage.getItem("jwt")||(window.location.href="../index.html");const _=[],g=new a.a(o.c),p=new d.a(s.a,s.b,s.d,s.c,"saved_articles"),m=new class{constructor(t,e){this.mainApi=e,this.articles=[],this.sortedArticles=[],this.reportContainer=t,this.ucFirst=l,this.reportSum=this.reportContainer.querySelector(".report__sum"),this.reportKeywords=this.reportContainer.querySelector(".report__keywords")}getSaveArticles(){this.articles=JSON.parse(window.localStorage.getItem("articles"))}setKeywords(){const t={};this.articles.forEach(e=>{t[e.keyword]?t[e.keyword]+=1:t[e.keyword]=1}),this.sortedArticles=Object.entries(t).sort((t,e)=>e[1]-t[1])}setNumberArticles(){this.reportSum.textContent=`${localStorage.getItem("name")}, у вас ${this.articles.length} сохранённых статей`}setArticlesInfo(){const t=this.sortedArticles.length;t>0&&(this.reportKeywords.append("По ключевым словам: "),this.reportFirstKeyword=document.createElement("strong"),this.reportFirstKeyword.classList.add("report__keyword"),this.reportFirstKeyword.textContent=this.ucFirst(this.sortedArticles[0][0]),this.reportKeywords.appendChild(this.reportFirstKeyword),t>1&&(this.reportKeywords.append(", "),this.reportSecondKeyword=document.createElement("strong"),this.reportSecondKeyword.classList.add("report__keyword"),this.reportSecondKeyword.textContent=this.ucFirst(this.sortedArticles[1][0]),this.reportKeywords.appendChild(this.reportSecondKeyword),t>2&&(this.reportKeywords.append(" и"),this.reportOtherKeyword=document.createElement("strong"),this.reportSecondKeyword.classList.add("report__keyword"),this.reportOtherKeyword.textContent=` ${t-2} другим`,this.reportKeywords.appendChild(this.reportOtherKeyword))))}}(i,g),w=new h.a(n.a,g,"saved_articles"),y=new c.a(n.b,n.c,w);g.getArticles().then(t=>{window.localStorage.setItem("articles",JSON.stringify(t.data)),p.render(),m.getSaveArticles(),m.setNumberArticles(),m.setKeywords(),m.setArticlesInfo(),u(t.data,_),y.renderSaveCard({articles:_})})}]);